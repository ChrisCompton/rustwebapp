box: adreeve/rust-nightly:2015-07-02

dev:
  steps:
    - script:
        name: build
        code: |
          rustc -V
          cargo -V
          cargo build
          cargo test

build:
  services:
    - id: sameersbn/postgresql
      tag: 9.4-1
      env:
        DB_USER: dbuser
        DB_PASS: dbpass
        DB_NAME: test
  steps:
    - script:
        name: build
        code: |
          export DATABASE_URL=postgres://dbuser:dbpass@postgresql:5432/test
          rustc -V
          cargo -V
          cargo build --verbose
          cargo test --features integration_tests

# deploy:
#   steps:
#     - internal/docker-push:
#         username: $DOCKER_USERNAME
#         password: $DOCKER_PASSWORD
#         ports: "8080"
#         cmd: cargo run
#         repository: jakescott/rustwebapp
#         registry: https://registry.hub.docker.com

deploy:
  steps:
    - script:
        name: push to deis
        code: |
          echo "works"
          sudo apt-get install git
# curl -sSL http://deis.io/deis-cli/install.sh | sh
# ./deis --version
# ./deis keys:add 
# ./deis auth:login http://deis.superlogical.io --username=$DEIS_USERNAME --password=$DEIS_PASSWORD